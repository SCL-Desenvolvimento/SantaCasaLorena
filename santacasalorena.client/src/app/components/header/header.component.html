<header class="main-header bg-white shadow sticky-top">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center py-3">

      <!-- Logo -->
      <a class="d-flex align-items-center text-decoration-none" routerLink="/">
        <img src="../../../assets/img/logo/logo.svg"
             alt="Santa Casa de Lorena"
             class="img-fluid logo">
      </a>

      <!-- Desktop Navigation -->
      <nav class="d-none d-lg-flex gap-4 align-items-center">
        <ng-container *ngFor="let item of menuItems">
          <!-- Com submenu -->
          <div class="nav-item dropdown" *ngIf="item.children; else noChildren">
            <a class="nav-link dropdown-toggle fw-medium"
               href="#"
               id="{{item.name}}Dropdown"
               role="button"
               aria-expanded="false">
              {{ item.name }}
            </a>
            <ul class="dropdown-menu shadow-lg animate__animated animate__fadeIn"
                [attr.aria-labelledby]="item.name + 'Dropdown'">
              <li *ngFor="let child of item.children">
                <a class="dropdown-item"
                   [routerLink]="child.path"
                   routerLinkActive="active">
                  {{ child.name }}
                </a>
              </li>
            </ul>
          </div>

          <!-- Sem submenu -->
          <ng-template #noChildren>
            <a class="nav-link fw-medium"
               [routerLink]="item.path"
               routerLinkActive="active"
               [routerLinkActiveOptions]="{ exact: true }">
              {{ item.name }}
            </a>
          </ng-template>
        </ng-container>

        <!-- Fale Conosco Dropdown -->
        <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle fw-medium"
             href="#"
             id="faleConoscoDropdown"
             role="button"
             aria-expanded="false">
            Fale Conosco
          </a>
          <ul class="dropdown-menu shadow-lg animate__animated animate__fadeIn"
              aria-labelledby="faleConoscoDropdown">
            <li>
              <a class="dropdown-item d-flex align-items-center"
                 routerLink="/whatsapp">
                <i class="bi bi-whatsapp text-success me-2"></i>
                WhatsApp
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item d-flex align-items-center"
                 href="tel:1231593344">
                <i class="bi bi-telephone text-primary me-2"></i>
                (12) 3159-3344
              </a>
            </li>
            <li>
              <a class="dropdown-item d-flex align-items-center"
                 href="https://maps.google.com/?q=Rua Dom Bosco - 562 Centro, Lorena/SP"
                 target="_blank">
                <i class="bi bi-geo-alt text-primary me-2"></i>
                Localização
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- CTA Desktop -->
      <div class="d-none d-lg-flex gap-2">
        <a routerLink="/doacoes" class="btn btn-donation">
          Doação
        </a>
        <a (click)="navigateToExternal('https://1741prd-vivace-portal.cloudmv.com.br:432/login')" class="btn btn-exam">
          Resultado de exames
        </a>
      </div>

      <!-- Mobile Toggle -->
      <button class="btn d-lg-none p-0" (click)="toggleMenu()">
        <i [class]="'bi ' + (isMenuOpen ? 'bi-x-lg' : 'bi-list') + ' fs-2'"></i>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div *ngIf="isMenuOpen" class="mobile-menu d-lg-none border-top pt-3 pb-3">
      <nav class="d-flex flex-column gap-3">

        <ng-container *ngFor="let item of menuItems">
          <!-- Com submenu -->
          <div *ngIf="item.children; else simpleLink" class="mobile-submenu">
            <button class="submenu-toggle d-flex justify-content-between align-items-center w-100 fw-bold text-dark"
                    (click)="item.open = !item.open">
              {{ item.name }}
              <i class="bi transition"
                 [class]="item.open ? 'bi-chevron-up rotate' : 'bi-chevron-down'"></i>
            </button>

            <div [ngClass]="{'submenu-collapsed': !item.open, 'submenu-expanded': item.open}">
              <a *ngFor="let child of item.children"
                 class="nav-link text-dark ps-3 py-1 d-block"
                 (click)="navigateTo(child.path)">
                {{ child.name }}
              </a>
            </div>
          </div>

          <!-- Sem submenu -->
          <ng-template #simpleLink>
            <a class="nav-link fw-medium"
               (click)="item.path && navigateTo(item.path)">
              {{ item.name }}
            </a>
          </ng-template>
        </ng-container>

        <!-- Fale Conosco Mobile -->
        <div class="mobile-submenu">
          <button class="submenu-toggle d-flex justify-content-between align-items-center w-100 fw-bold text-dark"
                  (click)="faleConoscoOpen = !faleConoscoOpen">
            Fale Conosco
            <i class="bi transition"
               [class]="faleConoscoOpen ? 'bi-chevron-up rotate' : 'bi-chevron-down'"></i>
          </button>

          <div [ngClass]="{'submenu-collapsed': !faleConoscoOpen, 'submenu-expanded': faleConoscoOpen}">
            <a class="nav-link text-dark ps-3 py-1 d-block d-flex align-items-center"
               routerLink="/whatsapp">
              <i class="bi bi-whatsapp text-success me-2"></i>
              WhatsApp
            </a>
            <a class="nav-link text-dark ps-3 py-1 d-block d-flex align-items-center"
               href="tel:1231593344">
              <i class="bi bi-telephone text-primary me-2"></i>
              (12) 3159-3344
            </a>
            <a class="nav-link text-dark ps-3 py-1 d-block d-flex align-items-center"
               href="https://maps.google.com/?q=Rua Dom Bosco - 562 Centro, Lorena/SP"
               target="_blank">
              <i class="bi bi-geo-alt text-primary me-2"></i>
              Localização
            </a>
          </div>
        </div>

        <!-- CTA Mobile -->
        <!--<a class="btn btn-donation mt-3" (click)="navigateTo('/')">
          Doação
        </a>-->
        <a class="btn btn-exam mt-2" (click)="navigateToExternal('https://1741prd-vivace-portal.cloudmv.com.br:432/login')">
          Resultado de exames
        </a>
      </nav>
    </div>
  </div>
</header>
